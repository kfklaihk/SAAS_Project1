{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/ubuntu/Downloads/Saas/lib/stripe.ts"],"sourcesContent":["// /lib/stripe.ts\r\nimport Stripe from 'stripe';\r\nexport const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n  apiVersion: '2024-06-20',\r\n});\r\n\r\n// Use your real price IDs from Stripe Dashboard\r\nexport const PRICE_IDS = {\r\n  monthly: process.env.STRIPE_PRICE_MONTHLY_ID!,\r\n  annual: process.env.STRIPE_PRICE_ANNUAL_ID!,\r\n};"],"names":[],"mappings":"AAAA,iBAAiB;;;;;;;AACjB;;AACO,MAAM,SAAS,IAAI,mKAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAG;IAC/D,YAAY;AACd;AAGO,MAAM,YAAY;IACvB,SAAS,QAAQ,GAAG,CAAC,uBAAuB;IAC5C,QAAQ,QAAQ,GAAG,CAAC,sBAAsB;AAC5C"}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file:///home/ubuntu/Downloads/Saas/lib/supabaseClient.ts"],"sourcesContent":["// /lib/supabaseClient.ts\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.warn(\r\n    'Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in .env.local'\r\n  );\r\n}\r\n\r\nexport const supabase = createClient(\r\n  supabaseUrl || 'https://placeholder.supabase.co',\r\n  supabaseAnonKey || 'placeholder-key'\r\n);\r\n\r\n// For server-side service role operations (webhook updates):\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\nexport const supabaseAdmin = supabaseServiceRoleKey\r\n  ? createClient(supabaseUrl, supabaseServiceRoleKey)\r\n  : null;"],"names":[],"mappings":"AAAA,yBAAyB;;;;;;;AACzB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAMO,MAAM,WAAW,IAAA,yMAAY,EAClC,eAAe,mCACf,mBAAmB;AAGrB,6DAA6D;AAC7D,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAE7D,MAAM,gBAAgB,yBACzB,IAAA,yMAAY,EAAC,aAAa,0BAC1B"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///home/ubuntu/Downloads/Saas/app/api/stripe/session/route.ts"],"sourcesContent":["// /app/api/stripe/session/route.ts\r\nimport { NextResponse } from 'next/server';\r\nimport { stripe, PRICE_IDS } from '@/lib/stripe';\r\nimport { supabaseAdmin } from '@/lib/supabaseClient';\r\n\r\nexport async function POST(req: Request) {\r\n  const { plan, userId, email } = await req.json();\r\n\r\n  if (!supabaseAdmin) {\r\n    return NextResponse.json(\r\n      { error: 'Supabase admin client not configured' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  // Ensure profile has a Stripe customer\r\n  const { data: profile } = await supabaseAdmin\r\n    .from('profiles')\r\n    .select('*')\r\n    .eq('id', userId)\r\n    .single();\r\n\r\n  let customerId = profile?.stripe_customer_id;\r\n  if (!customerId) {\r\n    const customer = await stripe.customers.create({ email });\r\n    customerId = customer.id;\r\n    const { error: updateErr } = await supabaseAdmin.from('profiles').update({\r\n      stripe_customer_id: customerId\r\n    }).eq('id', userId);\r\n    \r\n    if (updateErr) {\r\n      console.error('Failed to update stripe_customer_id:', updateErr);\r\n    }\r\n  }\r\n\r\n  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\r\n  \r\n  const session = await stripe.checkout.sessions.create({\r\n    mode: 'subscription',\r\n    customer: customerId,\r\n    line_items: [{ price: plan === 'annual' ? PRICE_IDS.annual : PRICE_IDS.monthly, quantity: 1 }],\r\n    success_url: `${baseUrl}/dashboard?status=success`,\r\n    cancel_url: `${baseUrl}/dashboard?status=cancel`,\r\n    allow_promotion_codes: true,\r\n    automatic_tax: { enabled: true },\r\n    customer_update:{'address': 'auto'},\r\n    currency: 'hkd', // or 'usd'\r\n  });\r\n\r\n  if (!session.url) {\r\n    return NextResponse.json(\r\n      { error: 'Failed to create checkout session' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return NextResponse.json({ url: session.url });\r\n}"],"names":[],"mappings":"AAAA,mCAAmC;;;;;AACnC;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;IAE9C,IAAI,CAAC,wIAAa,EAAE;QAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuC,GAChD;YAAE,QAAQ;QAAI;IAElB;IAEA,uCAAuC;IACvC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,wIAAa,CAC1C,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;IAET,IAAI,aAAa,SAAS;IAC1B,IAAI,CAAC,YAAY;QACf,MAAM,WAAW,MAAM,yHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;YAAE;QAAM;QACvD,aAAa,SAAS,EAAE;QACxB,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,wIAAa,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC;YACvE,oBAAoB;QACtB,GAAG,EAAE,CAAC,MAAM;QAEZ,IAAI,WAAW;YACb,QAAQ,KAAK,CAAC,wCAAwC;QACxD;IACF;IAEA,MAAM,UAAU,6DAAoC;IAEpD,MAAM,UAAU,MAAM,yHAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;QACpD,MAAM;QACN,UAAU;QACV,YAAY;YAAC;gBAAE,OAAO,SAAS,WAAW,4HAAS,CAAC,MAAM,GAAG,4HAAS,CAAC,OAAO;gBAAE,UAAU;YAAE;SAAE;QAC9F,aAAa,GAAG,QAAQ,yBAAyB,CAAC;QAClD,YAAY,GAAG,QAAQ,wBAAwB,CAAC;QAChD,uBAAuB;QACvB,eAAe;YAAE,SAAS;QAAK;QAC/B,iBAAgB;YAAC,WAAW;QAAM;QAClC,UAAU;IACZ;IAEA,IAAI,CAAC,QAAQ,GAAG,EAAE;QAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,KAAK,QAAQ,GAAG;IAAC;AAC9C"}}]
}